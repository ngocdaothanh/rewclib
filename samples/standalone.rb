require 'rubygems'require 'opengl'require 'glut'require 'fileutils'dir = File.dirname(__FILE__)require dir + '/../rewclib'WIDTH  = 640HEIGHT = 480FPS    = 30$cam = Rewclib.newunless $cam.open(WIDTH, HEIGHT, FPS)  puts 'No camera'  exitenddef display  image = $cam.image(true, 3)  glDrawPixels(WIDTH, HEIGHT, GL_RGB, GL_UNSIGNED_BYTE, image)  glutSwapBuffersenddef idle  glutPostRedisplayenddef keyboard(key, x, y)  case key    when "\r"      image = $cam.image(false, 1)  # Not upsidedown, Green      File.open("#{$i}.dat", 'wb') { |f| f.write(image) }      File.open("#{$i}.pgm", 'wb') { |f| f.write("P5\n#{WIDTH} #{HEIGHT}\n255\n"); f.write(image) }      puts "Captured image #{$i}"      $i += 1    when "\e"  # ESC      glutDestroyWindow(@window) if @window      exit  end  glutPostRedisplayendglutInitglutInitDisplayMode(GLUT_RGB | GLUT_DOUBLE | GLUT_ALPHA | GLUT_DEPTH)glutInitWindowSize(WIDTH, HEIGHT)glutCreateWindow('Camera')glutDisplayFunc(method(:display).to_proc)glutIdleFunc(method(:idle).to_proc)glutKeyboardFunc(method(:keyboard).to_proc)FileUtils.rm(Dir.glob('./*.{dat,pgm}'))$i = 0puts '[enter] to capture, [esc] to quit'glutMainLoop$cam.close